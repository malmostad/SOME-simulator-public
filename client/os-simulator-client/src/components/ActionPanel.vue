<template>
    <div class="action-panel">
        <div class="bot-reply">
            Välj hur följarna ska reagera på kommentaren:
            
            <Tooltip v-bind:content="'Positivt'">
            <span
                class="happy"
                @click="addBotReply(2)"
                :class="{ active: sessionLogAction.botReplyProperties === 2 }"
            >
                <svg
                    width="25px"
                    height="25px"
                    viewBox="0 0 25 25"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                    <g
                        id="Facilitator"
                        stroke="none"
                        stroke-width="1"
                        fill="none"
                        fill-rule="evenodd"
                    >
                        <g
                            id="MODAL---Bedöm-kommentar"
                            transform="translate(-487.000000, -543.000000)"
                            fill="#7A7A7A"
                            fill-rule="nonzero"
                        >
                            <g
                                id="smiling-emoticon-square-face"
                                transform="translate(487.000000, 543.000000)"
                            >
                                <path
                                    d="M21.3434347,3.6578776 C16.466875,-1.21909608 8.53280093,-1.21909608 3.65718408,3.65669901 C-1.21937564,8.53249411 -1.2189042,16.4667104 3.65765552,21.3434483 C8.53280093,26.2190077 16.466875,26.2190077 21.3429633,21.3425054 C26.2190515,16.4667104 26.2188158,8.53296554 21.3434347,3.6578776 Z M19.978856,19.9788857 C15.8551835,24.1025095 9.14519952,24.102981 5.02129135,19.9793571 C0.896676013,15.8550261 0.897147452,9.14441406 5.02129135,5.0207902 C9.1449638,0.897402064 15.8547121,0.896930631 19.9793274,5.02126163 C24.1029999,9.14488549 24.1025284,15.8554976 19.978856,19.9788857 Z M7.83530768,9.11542093 C7.83530768,8.30832775 8.48990003,7.65374313 9.29700272,7.65374313 C10.1038697,7.65374313 10.758462,8.30809203 10.758462,9.11542093 C10.758462,9.92298554 10.1038697,10.5773345 9.29700272,10.5773345 C8.48990003,10.5773345 7.83530768,9.92298554 7.83530768,9.11542093 Z M14.4630257,9.11542093 C14.4630257,8.30832775 15.1180895,7.65374313 15.9251921,7.65374313 C16.7320591,7.65374313 17.3866515,8.30809203 17.3866515,9.11542093 C17.3866515,9.92298554 16.7322948,10.5773345 15.9251921,10.5773345 C15.1180895,10.5773345 14.4630257,9.92298554 14.4630257,9.11542093 Z M17.9186698,15.101912 C17.0128007,17.1967242 14.8913275,18.5502082 12.5143347,18.5502082 C10.0861907,18.5502082 7.95222443,17.1898885 7.07770603,15.084469 C6.92778859,14.7240585 7.09868505,14.3101404 7.45957121,14.1602247 C7.54820164,14.1236887 7.64013215,14.1062457 7.73064834,14.1062457 C8.00785417,14.1062457 8.27091685,14.2700686 8.38382637,14.5423211 C9.03841871,16.1183214 10.6596957,17.1361451 12.5143347,17.1361451 C14.3270157,17.1361451 15.9388639,16.1176143 16.6205639,14.5406711 C16.7756672,14.1821464 17.1919474,14.0169091 17.5502406,14.1722463 C17.9085339,14.3275834 18.0737731,14.743623 17.9186698,15.101912 Z"
                                    id="Shape"
                                ></path>
                            </g>
                        </g>
                    </g>
                </svg>
            </span>
            </Tooltip>
            <Tooltip v-bind:content="'Negativt'">
            <span
                class="sad"
                @click="addBotReply(4)"
                :class="{ active: sessionLogAction.botReplyProperties === 4 }"
            >
                <svg
                    width="25px"
                    height="25px"
                    viewBox="0 0 25 25"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                    <g
                        id="Facilitator"
                        stroke="none"
                        stroke-width="1"
                        fill="none"
                        fill-rule="evenodd"
                    >
                        <g
                            id="MODAL---Bedöm-kommentar"
                            transform="translate(-525.000000, -543.000000)"
                            fill="#7A7A7A"
                            fill-rule="nonzero"
                        >
                            <g
                                id="sad-face-in-rounded-square"
                                transform="translate(525.000000, 543.000000)"
                            >
                                <path
                                    d="M21.1556075,3.62570093 C16.3219626,-1.20841121 8.45771028,-1.20841121 3.625,3.62453271 C-1.20864486,8.45747664 -1.20817757,16.3219626 3.62546729,21.1558411 C8.45771028,25.9885514 16.3219626,25.9885514 21.1551402,21.1549065 C25.9883178,16.3219626 25.9880841,8.45794393 21.1556075,3.62570093 Z M19.8030374,19.803271 C15.7156542,23.8906542 9.06471963,23.8911215 4.9771028,19.8037383 C0.888785048,15.7156542 0.889252337,9.06401869 4.9771028,4.97663551 C9.06448598,0.889485981 15.7151869,0.889018692 19.8035047,4.9771028 C23.8908879,9.06448598 23.8904206,15.7161215 19.8030374,19.803271 Z M17.9946262,17.2899533 C18.1483645,17.6453271 17.9848131,18.0577103 17.6296729,18.211215 C17.2742991,18.3654206 16.8619159,18.2014019 16.7081776,17.8462617 C16.032243,16.2834112 14.4348131,15.2733645 12.6378505,15.2733645 C10.7995327,15.2733645 9.19228972,16.2824766 8.54392523,17.8443925 C8.43200935,18.1140187 8.17102804,18.2768692 7.89649533,18.2768692 C7.8067757,18.2768692 7.71588785,18.2595794 7.62780374,18.2231308 C7.2703271,18.0745327 7.10093458,17.6642523 7.24929907,17.3070093 C8.1161215,15.2200935 10.2315421,13.871729 12.6378505,13.871729 C14.9939252,13.871729 17.096729,15.2133178 17.9946262,17.2899533 Z M7.76635514,9.03528037 C7.76635514,8.23528037 8.41518692,7.5864486 9.21518692,7.5864486 C10.0149533,7.5864486 10.663785,8.23504673 10.663785,9.03528037 C10.663785,9.83574766 10.0149533,10.4843458 9.21518692,10.4843458 C8.41518692,10.4843458 7.76635514,9.83574766 7.76635514,9.03528037 Z M14.3357477,9.03528037 C14.3357477,8.23528037 14.9850467,7.5864486 15.7850467,7.5864486 C16.5848131,7.5864486 17.2336449,8.23504673 17.2336449,9.03528037 C17.2336449,9.83574766 16.5850467,10.4843458 15.7850467,10.4843458 C14.9850467,10.4843458 14.3357477,9.83574766 14.3357477,9.03528037 Z"
                                    id="Shape"
                                ></path>
                            </g>
                        </g>
                    </g>
                </svg>
            </span>
            </Tooltip>
        </div>
        <div class="action-category">
            Flagga kommentar:
            <Tooltip v-bind:content="'Kommentaren är intressant utifrån: fakta'">
            <span
                class="tag facts"
                @click="addTag(tags.facts)"
                :class="{ active: sessionLogAction.sessionLogTag & tags.facts }"
            >
                <svg
                    width="13px"
                    height="16px"
                    viewBox="0 0 13 16"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                    <g
                        id="Facilitator"
                        stroke="none"
                        stroke-width="1"
                        fill="none"
                        fill-rule="evenodd"
                    >
                        <g
                            id="Facilitator-View-Main"
                            transform="translate(-479.000000, -658.000000)"
                            fill="#7A7A7A"
                            fill-rule="nonzero"
                        >
                            <g
                                id="document"
                                transform="translate(479.000000, 658.000000)"
                            >
                                <path
                                    d="M0,1.94923885 L0,15.7348625 C0,15.8812996 0.122540549,16 0.273715212,16 L10.673766,16 C10.8248279,16 10.9473684,15.8812996 10.9473684,15.7348625 L10.9473684,4.60039592 C10.9473684,4.59449911 10.9444374,4.58947593 10.9438737,4.58368834 C10.9425209,4.56042872 10.9377861,4.53749674 10.9298949,4.51554755 C10.9268511,4.50702994 10.9247091,4.49883996 10.9208762,4.49054073 C10.9075738,4.46171194 10.8890856,4.43539475 10.8660881,4.41289957 L8.12927417,1.76185172 C8.1060512,1.7394657 8.07876988,1.7215569 8.04878294,1.70878051 C8.04055346,1.70539531 8.03221125,1.70255612 8.02364353,1.70004452 C8.00075879,1.6924005 7.97697217,1.68781412 7.95273461,1.6862853 C7.94811257,1.68704971 7.9427014,1.68421053 7.93695202,1.68421053 L0.273715212,1.68421053 C0.122540549,1.68421053 0,1.80280169 0,1.94923885 Z M10.0130391,4.33525838 L8.2105545,4.33525838 L8.2105545,2.58925994 L10.0130391,4.33525838 Z M0.547317699,2.21437643 L7.66323681,2.21437643 L7.66323681,4.60039592 C7.66323681,4.74672389 7.78577735,4.86542428 7.93683929,4.86542428 L10.4000507,4.86542428 L10.4000507,15.4698341 L0.547317699,15.4698341 L0.547317699,2.21437643 Z"
                                    id="Shape"
                                ></path>
                                <path
                                    d="M11.5368421,13.7856236 L11.5368421,14.3157895 L12.3578666,14.3157895 C12.5090397,14.3157895 12.6315789,14.1971983 12.6315789,14.0507611 L12.6315789,0.265137546 C12.6315789,0.118700383 12.5090397,0 12.3578666,0 L1.95792295,0 C1.80674981,0 1.68421053,0.118700383 1.68421053,0.265137546 L1.68421053,1.06044099 L2.23163531,1.06044099 L2.23163531,0.530165899 L12.0841542,0.530165899 L12.0841542,13.7856236 L11.5368421,13.7856236 Z"
                                    id="Path"
                                ></path>
                                <polygon
                                    id="Path"
                                    points="2.52631579 5.05263158 9.26315789 5.05263158 9.26315789 5.89473684 2.52631579 5.89473684"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="2.52631579 3.36842105 5.05263158 3.36842105 5.05263158 4.21052632 2.52631579 4.21052632"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="2.52631579 6.73684211 6.73684211 6.73684211 6.73684211 7.57894737 2.52631579 7.57894737"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="6.73684211 6.73684211 8.42105263 6.73684211 8.42105263 7.57894737 6.73684211 7.57894737"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="2.52631579 8.42105263 9.26315789 8.42105263 9.26315789 9.26315789 2.52631579 9.26315789"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="2.52631579 11.7894737 9.26315789 11.7894737 9.26315789 12.6315789 2.52631579 12.6315789"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="5.05263158 10.1052632 9.26315789 10.1052632 9.26315789 10.9473684 5.05263158 10.9473684"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="2.52631579 10.1052632 4.21052632 10.1052632 4.21052632 10.9473684 2.52631579 10.9473684"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="1.68421053 13.4736842 3.36842105 13.4736842 3.36842105 14.3157895 1.68421053 14.3157895"
                                ></polygon>
                                <polygon
                                    id="Path"
                                    points="4.21052632 13.4736842 9.26315789 13.4736842 9.26315789 14.3157895 4.21052632 14.3157895"
                                ></polygon>
                            </g>
                        </g>
                    </g>
                </svg>
            </span>
            </Tooltip>
            <Tooltip v-bind:content="'Kommentaren är intressant utifrån: empati'">
            <span
                class="tag emotional"
                @click="addTag(tags.emotional)"
                :class="{
                    active: sessionLogAction.sessionLogTag & tags.emotional,
                }"
            >
                
                <svg
                    width="17px"
                    height="16px"
                    viewBox="0 0 17 16"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                    <g
                        id="Facilitator"
                        stroke="none"
                        stroke-width="1"
                        fill="none"
                        fill-rule="evenodd"
                    >
                        <g
                            id="Facilitator-View-Main"
                            transform="translate(-248.000000, -658.000000)"
                            fill="#7A7A7A"
                            fill-rule="nonzero"
                        >
                            <g
                                id="like"
                                transform="translate(248.000000, 658.000000)"
                            >
                                <path
                                    d="M16.730839,4.9124966 C16.4862133,2.2200024 14.5804534,0.2665421 12.1954334,0.2665421 C10.6064944,0.2665421 9.15163221,1.121604 8.33299021,2.4920236 C7.52176111,1.1038775 6.12652441,0.2662198 4.56304711,0.2662198 C2.17834941,0.2662198 0.272267209,2.2196801 0.0279638091,4.9121743 C0.00862580908,5.031103 -0.0706599909,5.6570096 0.170420409,6.6777337 C0.517859809,8.1500001 1.32038681,9.4891566 2.49065811,10.5495236 L8.32912261,15.8478133 L14.2678224,10.5498459 C15.4380937,9.4891566 16.2406207,8.1503224 16.5880601,6.6777337 C16.8291405,5.6573319 16.7498547,5.0314253 16.730839,4.9124966 Z M15.960542,6.5301203 C15.6433988,7.8747559 14.9082325,9.0998182 13.836585,10.0705858 L8.33299021,14.9808263 L2.92382931,10.071875 C1.85024801,9.0991736 1.11540401,7.8744336 0.797938509,6.529798 C0.569750109,5.5638649 0.663539409,5.018211 0.663861709,5.0146657 L0.668696209,4.9821134 C0.878191209,2.6231997 2.51579751,0.9108198 4.56304711,0.9108198 C6.07366721,0.9108198 7.40347701,1.8390438 8.03454041,3.3329043 L8.33137871,4.0364852 L8.62821701,3.3329043 C9.24928911,1.8619271 10.6493603,0.9111421 12.1957557,0.9111421 C14.242683,0.9111421 15.8806116,2.623522 16.0942965,5.0130542 C16.0949411,5.018211 16.1887304,5.5641872 15.960542,6.5301203 Z"
                                    id="Shape"
                                ></path>
                            </g>
                        </g>
                    </g>
                </svg>
            </span>
            </Tooltip>
            <Tooltip v-bind:content="'Kommentaren är intressant utifrån: tonalitet'">
            <span
                class="tag tone"
                @click="addTag(tags.tone)"
                :class="{ active: sessionLogAction.sessionLogTag & tags.tone }"
            >
                <svg
                    width="17px"
                    height="16px"
                    viewBox="0 0 17 16"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                    <g
                        id="Facilitator"
                        stroke="none"
                        stroke-width="1"
                        fill="none"
                        fill-rule="evenodd"
                    >
                        <g
                            id="Facilitator-View-Main"
                            transform="translate(-358.000000, -658.000000)"
                            fill="#7A7A7A"
                            fill-rule="nonzero"
                        >
                            <path
                                d="M372.776108,662.384199 L372.776108,658.297518 C372.776108,658.178525 372.706075,658.071026 372.598043,658.024101 C372.490043,657.977177 372.364817,657.999988 372.279656,658.081933 C370.513525,659.78258 368.198459,660.719112 365.760877,660.719112 L362.205229,660.719112 C362.042874,660.719112 361.911326,660.85231 361.911326,661.016627 C361.911326,661.180945 362.042874,661.314143 362.205229,661.314143 L365.760909,661.314143 C367.483588,661.314143 369.148524,660.873209 370.622622,660.046331 L370.622622,661.352414 C370.622622,661.516731 370.754171,661.649929 370.916526,661.649929 C371.078881,661.649929 371.210429,661.516731 371.210429,661.352414 L371.210429,659.689351 C371.548752,659.467595 371.875526,659.224874 372.188333,658.960862 L372.188333,662.589138 C372.188301,662.592241 372.188301,662.595343 372.188333,662.598412 L372.188333,667.383018 C372.188301,667.38612 372.188301,667.389223 372.188333,667.392292 L372.188333,670.463058 C371.875559,670.199014 371.548784,669.95626 371.210429,669.734568 L371.210429,662.435858 C371.210429,662.27154 371.078881,662.138343 370.916526,662.138343 C370.754171,662.138343 370.622622,662.27154 370.622622,662.435858 L370.622622,669.377524 C369.148524,668.550646 367.483588,668.109712 365.760909,668.109712 L361.875196,668.109712 C360.784099,668.109712 359.896453,667.211157 359.896453,666.106651 L359.896453,663.317204 C359.896453,662.51031 360.37084,661.785804 361.105067,661.471472 C361.254519,661.407437 361.324519,661.232865 361.261228,661.081544 C361.198035,660.930223 361.025551,660.859396 360.876067,660.923431 C359.929485,661.328739 359.31613,662.259785 359.309001,663.298819 L358.891323,663.298819 C358.399839,663.298917 358,663.703637 358,664.201162 L358,665.501922 C358,665.999446 358.399871,666.404199 358.891323,666.404199 L359.325969,666.404199 C359.472324,667.697089 360.559421,668.704775 361.875196,668.704775 L365.056005,668.704775 L366.289909,672.973113 C366.319684,673.076008 366.300329,673.184225 366.236813,673.270041 C366.173329,673.355857 366.076103,673.405067 365.970199,673.405067 L364.246166,673.405067 C364.09923,673.405067 363.967779,673.30534 363.926488,673.162575 L362.820842,669.337946 C362.775229,669.180258 362.6121,669.089837 362.456229,669.135946 C362.300423,669.182119 362.211132,669.347351 362.256681,669.50504 L363.362327,673.329603 C363.476423,673.724331 363.83994,674 364.246166,674 L365.970199,674 C366.263038,674 366.531619,673.863929 366.7072,673.626759 C366.882781,673.389589 366.936329,673.090408 366.854071,672.805955 L366.410006,671.269821 L366.935329,671.269821 C367.228039,671.269821 367.49662,671.133847 367.672233,670.896775 C367.847814,670.659638 367.901459,670.360458 367.81933,670.075808 L367.468136,668.861027 C369.265202,669.192405 370.9323,670.044525 372.27972,671.341955 C372.33543,671.395639 372.408333,671.423917 372.482366,671.423917 C372.52143,671.423917 372.560817,671.416015 372.598108,671.399851 C372.70614,671.352959 372.776172,671.245428 372.776172,671.126435 L372.776172,667.597297 C373.825431,667.173017 374.516141,666.151812 374.516141,664.990748 C374.516141,663.829618 373.825399,662.808446 372.776108,662.384199 Z M359.032259,665.741929 L358.733474,665.741929 C358.613646,665.741965 358.516129,665.593388 358.516129,665.410773 L358.516129,664.008638 C358.516129,663.826024 358.613623,663.677412 358.733474,663.677412 L359.032259,663.677412 L359.032259,665.741929 Z M367.225628,670.761791 C367.164203,670.851653 367.070131,670.903223 366.967694,670.903223 L366.292987,670.903223 L365.741941,668.838706 L365.831426,668.838706 C366.178658,668.838706 366.523174,668.860573 366.863977,668.902527 L367.277128,670.450522 C367.305905,670.558384 367.287147,670.671859 367.225628,670.761791 Z M372.967753,667.290318 L372.967753,663.161282 C373.597183,663.562445 374.000012,664.3458 374.000012,665.225765 C374.000012,666.105731 373.597183,666.889155 372.967753,667.290318 Z"
                                id="Shape"
                            ></path>
                        </g>
                    </g>
                </svg>
            </span>
            </Tooltip>
        </div>
        <div class="show-comment">
            <button v-on:click="showForParticipants(sessionLog)" class="secondary share">Visa kommentar</button>
        </div>
        <!-- <div>{{sessionLogAction}}</div> -->
    </div>
</template>

<script lang="ts">
import { Component, Prop, Vue } from 'vue-property-decorator';
import SessionLogAction from '../Types/SessionLogAction';
import { SessionLog } from '../Types/SessionLog';
import Tooltip from './Tooltip.vue';
import {SessionLogTag} from "@/Types/SessionLogTag";

@Component({components: {Tooltip}, computed: { tags: () => SessionLogTag} })
export default class ActionPanel extends Vue {
    @Prop({ default: Object as () => SessionLog })
    public sessionLog!: SessionLog;
    private $hub: any;

    public showForParticipants(message: SessionLog) {
        console.log('emit2');
        this.$root.$emit('showForParticipants', message);
    }

    public sessionLogAction: SessionLogAction = {
        sessionLogId: this.sessionLog.id,
        botReplyProperties: this.sessionLog.botReplyProperties,
        sessionLogTag: this.sessionLog.sessionLogTag,
    };
    
    private selectedTags: number[] = [1];

    public addBotReply(botReply: number) {
        this.sessionLogAction.botReplyProperties = botReply;
        this.$store.dispatch('addSessionLogAction', this.sessionLogAction);
    }
    public addTag(tag: number) {
        if (this.isTagSelected(tag)) {
            this.selectedTags.splice(this.selectedTags.indexOf(tag), 1);
        } else {
            this.selectedTags.push(tag);
        }
        this.sessionLogAction.sessionLogTag = this.selectedTags.reduce(
            (a, b) => a + b,
            0
        );
        console.log(this.sessionLogAction.sessionLogTag);
        this.$store.dispatch('addSessionLogAction', this.sessionLogAction);
    }
    private isTagSelected(tag: number): boolean {
        return this.selectedTags.indexOf(tag) > 0;
    }
    public created() {
        Vue.prototype.hubStartPromise.then(() => {
            this.$hub.on('sessionTriggers', (sessionTrigger: any) => {
                const data = JSON.parse(sessionTrigger);
                console.log('SessionTrigger:', data);
                this.$store.commit('showDialog', data.Dialog);
                this.$store.commit('setStatus', data.Status);
            });
        });
    }
}
</script>

<style lang="scss" scoped>
@import '../assets/scss/spacings.scss';
@import '../assets/scss/colors.scss';

.show-comment{
    button.share {
        padding: 11px 10px;
        margin-right: 10px;

        &::after {
            content: '\00a0';
            background-image: url('../assets/icons/share.svg');
            width: 24px;
            height: 19px;
             background-size: contain;
            background-repeat: no-repeat;
            background-position: center center;
            display: inline-block;
            margin-left: 10px;
        }
    }    
}


.action-panel {
    color: #fff;
    display: flex;
    margin-top: $space-sm;
    
    .bot-reply {
        flex: 1;
        display: flex;
        padding-right: 20px;
        .happy,
        .sad {
            &.active {
                path {
                    fill: #fff;
                }
            }
            margin-left: $space-sm;
            width: 25px;
            height: 25px;
            path {
                transition: fill 300ms;
            }
            &:hover {
                path {
                    fill: #fff;
                }
            }
        }        
    }
    .action-category {
        flex: 1;
        .tag {
            margin-left: $space-sm;
            width: 35px;
            height: 35px;
            &.active {
                path {
                    fill: #fff;
                }
            }
            path {
                transition: fill 300ms;
            }
            &:hover {
                path {
                    fill: #fff;
                }
            }
        }
    }
    .show-comment {
        margin-right: 0;
    }
}

</style>
